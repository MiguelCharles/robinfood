<div class="banner" style="background: url('<%= image_url('banner.jpg')%>'); background-size: cover !important;">
 <div class="banner-content">
  <h1>Select <span class="green">deals</span> nearby</h1>
  <p>Discounted products in your area</p>
 </div>

 <div class="homepage-search">
  <form action="" method="get" class="form-inline">
   <div class="form-group">
     <input type="text" id="current_location" name="address" class="form-control" placeholder="Insert your current location" aria-describedby="sizing-addon1">
   </div>
    <button type="submit" id="localisation" class="btn btn-form">FIND DEALS</button>
  </form>
 </div>
</div>


<div class="container bottom">
 <% if @params_search %>
   <h3 class="text-center bottom">Today <span class="green"><strong> <%= @shops.uniq.length  %></strong></span> shops are offering <span class="green"><strong> <%= @promotions.uniq.length  %> </strong></span> discounted products in your area </h3>
 <% else %>

  <h3 class="text-center bottom">Today <span class="green"><strong> <%= @shops.count * 134 %></strong></span> shops are offering <span class="green"><strong> <%= @promotions.count * 302 %> </strong></span> discounted products on Robin Food</h3>
 <% end %>
 <div class="row">
 <% if @promotions.any? %>
   <% @promotions.each_with_index do |promo, index| %>
     <div class ="col-xs-12 col-md-4">
       <p class="promo-validity text-center"> <i class="fa fa-clock-o fa-lg" aria-hidden="true"></i> <%= distance_of_time_in_words(promo.validity - Time.now) %></p>
       <%= link_to promotion_path(promo) do %>
       <div class="thumbnail">
         <%= image_tag promo.photo_url, { :class=>"thumbnail-img" } unless promo.photo_url.nil?%>
         <div class="caption">
           <h4><%= promo.shop.name_of_the_store %></h4>
           <h5><strong><%= link_to promo.description, promotion_path(promo)%></strong></h5>
           <p class="promo-title"><%= promo.shop.category %></p>
           <p class="promo-discount"> - <%= ((1-(promo.price_after_promotion_to_float/promo.initial_price_to_float))*100).round %> %</p>
           <p class="promo-price"><%= number_with_precision(promo.price_after_promotion_to_float, precision: 2) %>â‚¬</p>
         </div>
       </div>
       <%end%>
     </div>
     <% if index.odd?%>
     <!--<div class="clearfix"></div>-->
     <% end %>
   <% end %>
   <% else %>
     <h2 class="text-center bottom">Unfortunately, we were not able to find any promotion near your current location</h2>
   <% end %>
   </div>
</div>
   <div id="map" style="width: 100%; height: 600px;"></div>

<% content_for(:after_js) do %>
 <%= javascript_tag do %>
   $(document).ready(function() {
     var handler = Gmaps.build('Google');
     handler.buildMap({ internal: { id: 'map' } }, function() {
       markers = handler.addMarkers(<%= raw @hash.to_json %>);
       handler.bounds.extendWith(markers);
       handler.fitMapToBounds();
       if (markers.length == 0) {
         handler.getMap().setZoom(2);
       } else if (markers.length == 1) {
         handler.getMap().setZoom(14);
       }
     });
   });
 <% end %>
<% end %>

