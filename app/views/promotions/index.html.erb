<!-- <div class="container-fluid" style="background: linear-gradient(to left, #56ab2f , #a8e063);"> -->
<div class="banner" style="background: linear-gradient(-225deg, rgba(148, 219, 70, 0.6) 0%, rgba(184,255,89,0.3) 50%), url('https://static.pexels.com/photos/41123/pexels-photo-41123.jpeg');">
  <div class="banner">
    <div class="banner-content">
      <h1>Good <span class="green">deals</span> nearby and for today</h1>
      <form action="" method="get" class="form-inline top">
          <div class="input-group input-group-lg top">
          <span class="input-group-addon" id="sizing-addon1"><i class="fa fa-street-view" aria-hidden="true"></i></span>
          <input type="text" name="address" class="form-control" placeholder="In which area are you?" aria-describedby="sizing-addon1">
          </div>
          <button type="submit" id="localisation"class="btn btn-form top">FIND DEALS</button>
      </form>
    </div>
  </div>
</div>

<div class="container top">
  <h2 class="text-center bottom">Find Your <strong><span class="green">Best Deals</span></strong> of the WEEK !</h2>
  <div class="row">
    <% @promotions.each_with_index do |promo, index| %>
      <div class ="col-xs-12 col-md-4">
        <p class="promo-validity text-center"> Deals ends in : <%= distance_of_time_in_words(promo.validity - Time.now) %></p>
        <div class="thumbnail">
          <%= image_tag promo.photo_url, { :class=>"thumbnail-img" }%>
          <div class="caption">
            <h4><%= promo.shop.name_of_the_store %></h4>
            <h5><strong><%= promo.shop.category %></strong></h5>
            <p class="promo-title"><%= link_to promo.description, promotion_path(promo)%></p>
            <p class="promo-discount"><%= promo.price_after_promotion_per_unit %> â‚¬ -<%= ((1-(promo.price_after_promotion_per_unit.to_f/promo.initial_price_per_unit.to_f))*100).round %> %</p>
            <%= link_to ' View Details', promotion_path(promo), { :class=>"btn-medium fa fa-pencil-square-o" } %>
          </div>
        </div>
      </div>
      <% if index.odd?%>
      <!--<div class="clearfix"></div>-->
      <% end %>
    <% end %>
    </div>
</div>
    <div id="map" style="width: 100%; height: 600px;"></div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      var handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function() {
        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if (markers.length == 0) {
          handler.getMap().setZoom(2);
        } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
        }
      });
    });
  <% end %>
<% end %>

<%= content_for(:after_js) do %>
  <script src="https://maps.googleapis.com/maps/api/js?libraries=places&amp;key=<%= ENV['GOOGLE_API_BROWSER_KEY'] %>"></script>
<% end %>
 <% content_for(:after_js) do %>
 <script>
$(document).ready(function()
$("#localisation").submit(function(){
  var user_address = $('#user_address').get(0);

  if (user_address) {
    var autocomplete = new google.maps.places.Autocomplete(user_address, { types: ['geocode'] });
    google.maps.event.addListener(autocomplete, 'place_changed', onPlaceChanged);
    google.maps.event.addDomListener(user_address, 'keydown', function(e) {
      if (e.keyCode == 13) {
        e.preventDefault(); // Do not submit the form on Enter.
      }
    });
  }
});

function onPlaceChanged() {
  var place = this.getPlace();
  var components = getAddressComponents(place);

  $('#user_address').trigger('blur').val(components.address);
  $('#user_zip_code').val(components.zip_code);
  $('#user_city').val(components.city);
  if (components.country_code) {
    $('#user_country').val(components.country_code);
  }
}

function getAddressComponents(place) {
  // If you want lat/lng, you can look at:
  // - place.geometry.location.lat()
  // - place.geometry.location.lng()

  var street_number = null;
  var route = null;
  var zip_code = null;
  var city = null;
  var country_code = null;
  for (var i in place.address_components) {
    var component = place.address_components[i];
    for (var j in component.types) {
      var type = component.types[j];
      if (type == 'street_number') {
        street_number = component.long_name;
      } else if (type == 'route') {
        route = component.long_name;
      } else if (type == 'postal_code') {
        zip_code = component.long_name;
      } else if (type == 'locality') {
        city = component.long_name;
      } else if (type == 'country') {
        country_code = component.short_name;
      }
    }
  }

  return {
    address: street_number == null ? route : (street_number + ' ' + route),
    zip_code: zip_code,
    city: city,
    country_code: country_code
  };
}
 </script>
<% end %>
